<!DOCTYPE html>
<html>
  <head>
    
    <meta name="generator" content="PORTALCFG">
    <meta name="created" content="sex, 17 jun 2011 13:05:43 GMT">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta charset='UTF-8'>
    <title>PortalCFG</title>
    <script type="text/javascript" src="json2.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type='text/javascript' src='knockout.js'></script>
    <script type="text/javascript" src="knockout.mapping-latest.js"></script>
 
<link href="PortalCFG.css" rel="stylesheet" type="text/css" />    

</head>

<body style="color:#0080FF; font-family: Arial; font-style: normal; text-decoration: none; font-size: 10pt;">

<Form name="form1" id="form1" method="post" action="">
<input id="trace1" type="hidden" value="!XTRACE1!">
<input id="trace2" type="hidden" value="!XTRACE2! Browse > ">
<input id="login" type="hidden" value="!XLOGIN!">
<input id="sessao" type="hidden" value="!XSESSAO!">
<input id="menu" type="hidden" value="!XMENU!">
<input id="tabela" type="hidden" value="!XTABELA!">
<input id="nometabela" type="hidden" value="!XNOMETABELA!">
<input id="tipotabela" type="hidden" value="!XTRACE2!">
<input id="tabpasta" type="hidden" value="!XTABPASTA!">
<input id="origem" type="hidden" value="BROWSE">
<input name="dados" id="dados" type="hidden" value=""/>

<div id="divCabecalho" name="divCabecalho" style="visibility:hidden;">

<div style="position:relative; left:030px; text-align:right; font-weight: bold; height: 10px;">&nbsp;</div>
<div id="xLinhaFina" style="position:relative;width:100%;height:0.6mm;"></div>
<div style="position:relative; left:030px; text-align:right; font-weight: bold; height: 10px;">&nbsp;</div>

<div style="position:relative; font-weight: bold; Left:010px;"> >> !XTRACE3! BROWSE </div>

<div style="position:relative; left:030px; text-align:right; font-weight: bold; height: 10px;">&nbsp;</div>
<div id="xLinhaFina" style="position:relative;width:100%;height:0.6mm;"></div>
<div style="position:relative;height: 15px;">&nbsp;</div>

</div>

<div id="divDados" name="divDados"  class="BordaDiv"  style="position:relative;float:left;visibility:hidden;">
<div id="xTitulo" style="height:10mm; margin-top:-1mm; text-indent:3mm; line-height:10mm;">
    <span style="font-family: Arial; font-weight: bold; font-style: normal; text-decoration: none; font-size: 11pt;">Tabelas</span>
    <a href data-bind="click: $root.ultimoBrowse" style="font-size: 14pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal; margin-right: 20px" title="ultimo">&gt;&gt;</a> 
    <a href data-bind="click: $root.proximoBrowse" style="font-size: 14pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal" title="proximo">&gt;</a>
    <span style="font-size: 12pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal"> / !XPAGINAFIM!</span>
    <span style="font-size: 12pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal" data-bind="text: nPaginaAtu"></span>
    <a href data-bind="click: $root.anteriorBrowse" style="font-size: 14pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal" title="anterior">&lt;</a>
    <a href data-bind="click: $root.primeiroBrowse" style="font-size: 14pt; text-decoration: none; float: right; font-weight: bold; color: #fff; font-style: normal" title="primeiro">&lt;&lt;</a>
</div>
<div id="xTitulo" style="background-color:#FFFFFF; height:1mm;">&nbsp;</div>
<table  name="!XTABELA!" data-bind="$el: $el, with: obterDados" width="100%" border="0" cellpadding="2" cellspacing="0" bordercolor="#0096FF" style="font-weight: normal; font-style: normal; text-decoration: none; font-size: 8pt; 
height:1.5mm;">

  <tr id="xTitulo2" style="font-weight: bold; font-size: 9pt; height:1.5mm">
      <td><div  style="margin-right: 1mm; margin-left: 1mm;"><strong>Operacao</strong></div></td>

     !XCABECALHO_TABELAS!

     <td><div style="margin-left:1mm; margin-right:1mm;"><strong>Codigo</strong></div></td>
  </tr>

     !XLINHAS_TABELAS!

     <tbody data-bind="if: (xbrowse!XTABELA!().length === 0)"><tr><td>
        <a name="!XTABELA!" href data-bind="click: $root.xinclusao, attr: {title : 'tabelas_cadastro'}"><img src="portal_mais.gif" width=18px height=16px border="0" title="Inclusao"></a>
     </td></tr></tbody>

</table>

</div>

<!--
<div>
    <textarea name="tasks" data-bind="value: ko.toJSON(obterDados)"></textarea>
</div>
-->

</Form>

<script type="text/html" id="statusTemplate1">
    <img data-bind="attr: { src: imagem, title: titulo }" width=18px height=16px border="0">
</script>

<script type='text/javascript'>

    var cTrace1 = document.form1.trace1.value;
    var cTrace2 = document.form1.trace2.value;

     parent.Frame1.hmheader.fMeudiv(cTrace1, cTrace2);
     parent.Frame1.hmheader.meutd1.innerHTML='<a href="javascript:history.go(-1);" style="text-decoration: none;"><ul><li>Voltar</li></ul></a>';
     parent.Frame1.hmheader.meutd2.innerHTML='';
     parent.Frame1.hmheader.meutd3.innerHTML='';


//Obter informacoes direto do elemento do bind
ko.bindingHandlers.$el = {
  init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
    var value = valueAccessor();
    //here we first create a jQuery object by using $(myelem)
    //before updating observable value
    value($(element).first());
    //console.log($(element).attr('name'));
  }
};


function ViewModel() {
        var self = this;

        self.$el                = ko.observable();
        self.obterDados = ko.observable();

        self.cLogin           = '!XLOGIN!';
        self.cSessao         = '!XSESSAO!';
        self.cTabela         = '!XTABELA!';
        self.cFiltro            = '!XVIEWFILTRO!';
        self.nPaginaAtu   = ko.observable(!XPAGINAATU!);
        self.nPaginaFim   = !XPAGINAFIM!;

        self.atualGRUPO = 'xxxxx';
        self.indiceGRUPO = -1;

        self.atualSUBGRUPO = 'xxxxx';
        self.indiceSUBGRUPO = -1;

        self.atualMINIGRUPO = 'xxxxx';
        self.indiceMINIGRUPO = -1;

        self.veGRUPO = function(indice, TR_GRUPO) {

                  if  (self.indiceGRUPO >= indice) {return false;}

                  if  (TR_GRUPO == "") {return false;}
                  if  (self.atualGRUPO == TR_GRUPO)  {return false;}

                  self.indiceGRUPO = indice;
                  self.atualGRUPO = TR_GRUPO;

                  self.atualSUBGRUPO = 'xxxxx';
                  self.indiceSUBGRUPO = -1;

                  self.atualMINIGRUPO = 'xxxxx';
                  self.indiceMINIGRUPO = -1;

                  return true;
        }

        self.veSUBGRUPO = function(indice, TR_SUBGRUPO) {

                  if  (self.indiceSUBGRUPO >= indice) {return false;}

                  if  (TR_SUBGRUPO == "") {return false;}
                  if  (self.atualSUBGRUPO == TR_SUBGRUPO)  {return false;}

                  self.indiceSUBGRUPO = indice;
                  self.atualSUBGRUPO = TR_SUBGRUPO;

                  self.atualMINIGRUPO = 'xxxxx';
                  self.indiceMINIGRUPO = -1;

                  return true;
        }

        self.veMINIGRUPO = function(indice, TR_MINIGRUPO) {

                  if  (self.indiceMINIGRUPO >= indice) {return false;}

                  if  (TR_MINIGRUPO == "") {return false;}
                  if  (self.atualMINIGRUPO == TR_MINIGRUPO)  {return false;}

                  self.indiceMINIGRUPO = indice;
                  self.atualMINIGRUPO = TR_MINIGRUPO;

                  return true;
        }

        // Comportamento    
        self.obterBrowse = function() {
               jQuery.ajax("obter_browser", {
                   data: ko.toJSON( { login: self.cLogin, sessao: self.cSessao, taborigem: self.cTabela, tabela: self.$el().attr('name'), filtro: self.cFiltro, paginaatu: self.nPaginaAtu(), paginafim: self.nPaginaFim}),
                   type: "post",   
                   contentType: "application/json",
                   success: function(result) {
                           var xJSon = ko.toJSON(result);
                           var cJSon = JSON.stringify(xJSon);
                           cJSon = cJSon.replace(/!!x/g,'\\x');
                           cJSon = eval(cJSon);  //Executa a acentuacao no token \x, nao delimitar com apostrofe pois resulta em erro no parse();
                           //console.log(cJSon);
                           xJSon = JSON.parse(cJSon);
                           self.obterDados(ko.mapping.fromJS(xJSon));
                   },
                   error : function(jq, st, error){
                             alert(error);
                   }
             });
        }

        self.proximoBrowse = function(){
               if (self.nPaginaAtu() >= self.nPaginaFim) {
                   alert('Pagina final!');
               } else {
                   self.nPaginaAtu(self.nPaginaAtu() + 1);
                   self.obterBrowse();
               }
        }

        self.anteriorBrowse = function(){
               if (self.nPaginaAtu() <= 1) {
                   alert('Pagina inicial!');
               } else {
                   self.nPaginaAtu(self.nPaginaAtu() - 1);
                   self.obterBrowse();
               }
        }

        self.primeiroBrowse = function(){
               self.nPaginaAtu(1);
               self.obterBrowse();
        }

        self.ultimoBrowse = function(){
               self.nPaginaAtu(self.nPaginaFim);
               self.obterBrowse();
        }

        self.manutencao = function(data,geral) {
             //console.log(geral.currentTarget.name) ;
             document.form1.dados.value = ko.toJSON({ login: self.cLogin, sessao: self.cSessao, operacao:  geral.currentTarget.name, codigo: data.idSequencial, taborigem: self.cTabela, tabela: data.tabela})
             document.form1.action = geral.currentTarget.title;
             document.form1.submit();
       }
 
        //--------- Opcao de inclusao -------
        self.xinclusao = function(data,geral) {
             //console.log(geral.currentTarget.title) ;
             document.form1.dados.value = ko.toJSON({ login: self.cLogin, sessao: self.cSessao, operacao:  3, codigo: 0, taborigem: self.cTabela, tabela: geral.currentTarget.name});
             document.form1.action = geral.currentTarget.title;
             document.form1.submit();
       }

};

var vm = new ViewModel();

ko.applyBindings(vm);

vm.obterBrowse();

$(document).ajaxComplete(function(){

     divCabecalho.style.visibility = "visible";
     divDados.style.visibility = "visible";

});
   
</script>
</body>
</html>